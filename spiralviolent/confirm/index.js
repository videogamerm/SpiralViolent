(t=>{function e(e){for(var a,o,r=e[0],l=e[1],c=e[2],u=0,d=[];u<r.length;u++)o=r[u],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&d.push(i[o][0]),i[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);for(h&&h(e);d.length;)d.shift()();return n.push.apply(n,c||[]),s()}function s(){for(var t,e=0;e<n.length;e++){for(var s=n[e],a=!0,r=1;r<s.length;r++){var l=s[r];0!==i[l]&&(a=!1)}a&&(n.splice(e--,1),t=o(o.s=s[0]))}return t}var a={},i={6:0},n=[];function o(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=t,o.c=a,o.d=(t,e,s)=>{o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=(t,e)=>{if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(s,a,(e=>t[e]).bind(null,a));return s},o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,"a",e),e},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.p="";var r=window.webpackJsonp=window.webpackJsonp||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var h=l;n.push([179,1,2,0]),s()})({174:(t,e,s)=>{"use strict";var a=s(52);s.n(a).a},175:(t,e,s)=>{},179:function(t,e,s){"use strict";s.r(e);var a=s(27),i=s(0),n=(s(33),s(5)),o=(s(62),s(56)),r=s.n(o),l=s(20),c=s.n(l),h=s(54),u=s(58),d=s(26),p=s(21),m=s(10);const f=Object(h.a)({});let g,b,v;var C={components:{Dropdown:r.a,VmCode:u.default,SettingCheck:d.a,Tooltip:c.a},data(){return{installable:!1,dependencyOK:!1,closeAfterInstall:n.a.get("closeAfterInstall"),message:"",code:"",commands:{close:this.close},info:{}}},computed:{trackTooltip(){return m.a.isFirefox>=68?this.i18n("installOptionTrackTooltip"):null},isLocal(){return!Object(i.p)(this.info.url)}},async mounted(){var t;this.message=this.i18n("msgLoadingData");const e=`confirm-${p.c.paths[0]}`;this.info=await Object(i.v)("CacheLoad",e),this.info?(v=m.a.isFirefox>=68&&(null==(t=this.info)?void 0:t.url.startsWith("file:")),this.guard=setInterval(i.v,5e3,"CacheHit",{key:e}),await this.loadData(),await this.parseMeta()):this.close()},beforeDestroy(){this.guard&&(clearInterval(this.guard),this.guard=null)},methods:{async loadData(t){this.installable=!1;const e=v?await new Promise(this.pingFilePort):await this.getScript(this.info.url);if(null==e||t&&this.code===e)throw 0;this.code=e},parseMeta(){return Object(i.v)("ParseMeta",this.code).then(t=>{const e=Object.keys(t.resources).map(e=>t.resources[e]),s=t.require.length+e.length;if(!s)return;let a=0;const n=[],o=()=>{this.message=this.i18n("msgLoadingDependency",[a,s])};o(),this.require={},this.resources={};const r=t.require.map(t=>{const e=Object(i.j)(t,this.info.url);return this.getFile(e,{useCache:!0}).then(t=>{this.require[e]=t})}).concat(e.map(t=>{const e=Object(i.j)(t,this.info.url);return this.getFile(e,{isBlob:!0,useCache:!0}).then(t=>{this.resources[e]=t})})).map(t=>t.then(()=>{a+=1,o()},t=>{n.push(t)}));return Promise.all(r).then(()=>{if(n.length)return Promise.reject(n.join("\n"));this.dependencyOK=!0})}).then(()=>{this.message=this.i18n("msgLoadedData"),this.installable=!0},t=>(this.message=this.i18n("msgErrorLoadingDependency",[t]),Promise.reject()))},close(){Object(i.v)("TabClose")},getFile(t,{isBlob:e,useCache:s}={}){const a=e?`blob+${t}`:`text+${t}`;return s&&f.has(a)?Promise.resolve(f.get(a)):Object(i.u)(t,{responseType:e?"arraybuffer":null}).then(({data:t})=>e?window.btoa(Object(i.a)(t)):t).then(t=>(s&&f.put(a,t),t))},async getScript(t){try{return await Object(i.v)("CacheLoad",t)||await this.getFile(t)}catch(e){throw this.message=this.i18n("msgErrorLoadingData"),t}},getTimeString(){const t=new Date;return`${Object(i.q)(t.getHours(),2)}:${Object(i.q)(t.getMinutes(),2)}:${Object(i.q)(t.getSeconds(),2)}`},installScript(){return this.installable=!1,Object(i.v)("ParseScript",{code:this.code,url:this.info.url,from:this.info.from,require:this.require,cache:this.resources}).then(t=>{this.message=`${t.update.message}[${this.getTimeString()}]`,this.closeAfterInstall?this.close():this.isLocal&&this.trackLocalFile()},t=>{this.message=`${t}`,this.installable=!0})},async trackLocalFile(){var t;if(!this.tracking){for(this.tracking=!0;n.a.get("trackLocalFile")&&"stop"!==this.tracking;){await Object(i.r)(500);try{await this.loadData(!0),await this.parseMeta(),await this.installScript()}catch(t){}}this.tracking=!1,null==(t=g)||t.disconnect(),g=null}},checkClose(t){this.closeAfterInstall=t,t&&n.a.set("trackLocalFile",!1)},createFilePort(){g=browser.tabs.connect(this.info.tabId,{name:"FetchSelf"}),g.onMessage.addListener(t=>{b(t)}),g.onDisconnect.addListener(()=>{this.tracking="stop"})},pingFilePort(t){g||this.createFilePort(),b=t,g.postMessage(null)}}},y=(s(174),s(4)),O=Object(y.a)(C,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page-confirm frame flex flex-col h-100"},[s("div",{staticClass:"frame-block"},[s("div",{staticClass:"flex"},[s("h1",{staticClass:"mt-0 hidden-sm"},[s("span",{domProps:{textContent:t._s(t.i18n("labelInstall"))}}),t._v(" - "),s("span",{domProps:{textContent:t._s(t.i18n("extName"))}})]),s("div",{staticClass:"flex-auto"}),s("div",{staticClass:"text-right"},[s("dropdown",{staticClass:"confirm-options",attrs:{align:"right"}},[s("button",{attrs:{slot:"toggle"},domProps:{textContent:t._s(t.i18n("buttonInstallOptions"))},slot:"toggle"}),s("label",[s("setting-check",{attrs:{name:"closeAfterInstall"},on:{change:t.checkClose}}),s("span",{staticClass:"ml-1",domProps:{textContent:t._s(t.i18n("installOptionClose"))}})],1),s("label",[s("setting-check",{attrs:{name:"trackLocalFile",disabled:t.closeAfterInstall}}),s("tooltip",{attrs:{content:t.trackTooltip,disabled:!t.trackTooltip}},[s("span",{staticClass:"ml-1",domProps:{textContent:t._s(t.i18n("installOptionTrack"))}})])],1)]),s("button",{attrs:{disabled:!t.installable},domProps:{textContent:t._s(t.i18n("buttonConfirmInstallation"))},on:{click:t.installScript}}),s("button",{domProps:{textContent:t._s(t.i18n("buttonClose"))},on:{click:t.close}}),t.info.incognito?s("div",{staticClass:"incognito",domProps:{textContent:t._s(t.i18n("msgIncognitoChanges"))}}):t._e()],1)]),s("div",{staticClass:"flex"},[s("div",{staticClass:"ellipsis flex-auto mr-2",attrs:{title:t.info.url},domProps:{textContent:t._s(t.info.url)}}),s("div",{domProps:{textContent:t._s(t.message)}})])]),s("div",{staticClass:"frame-block flex-auto pos-rel"},[s("vm-code",{staticClass:"abs-full",attrs:{readonly:"",value:t.code,commands:t.commands}})],1)])}),[],!1,null,null,null).exports;s(175),a.default.prototype.i18n=i.m,document.title=`${Object(i.m)("labelInstall")} - ${Object(i.m)("extName")}`,n.a.ready.then(()=>{const t=document.createElement("div");document.body.appendChild(t),new a.default({render:t=>t(O)}).$mount(t)})},52:(t,e,s)=>{}});